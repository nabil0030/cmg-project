<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Synthèse Globale</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #e0e0e0;
            color: #333;
            padding: 20px;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
            border: 1px solid black;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
        }
        .home-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #5cb85c;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .home-button:hover {
            background-color: #4cae4c;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: white;
            border: 1px solid black;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .filters {
            display: flex;
            gap: 15px;
            padding: 15px;
            background-color: #f0f0f0;
            border-bottom: 1px solid black;
            flex-wrap: wrap;
        }
        .filters label {
            font-weight: bold;
        }
        .filters input, .filters button {
            padding: 8px;
            font-size: 0.9em;
            border: 1px solid #a0a0a0;
            border-radius: 3px;
        }
        .filters button {
            background-color: #3a8ee6;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .filters button:hover {
            background-color: #2a7bd3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }
        th, td {
            border: 1px solid black;
            padding: 8px 12px;
            text-align: left;
            font-size: 0.9em;
        }
        th {
            background-color: #4a77a8;
            color: white;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .cumul-mensuel-label, .cumul-annuel-label, .total-global-label {
            font-weight: bold;
            color: white;
            text-align: center;
        }
        .cumul-mensuel-label { background-color: #4a77a8; }
        .cumul-annuel-label { background-color: #4a77a8; }
        .total-global-label { background-color: #8A2BE2; }

        .cumul-mensuel-value { background-color: #6a9bd6; text-align: right; color: white; font-weight: bold; }
        .cumul-annuel-value { background-color: #5cb85c; text-align: right; color: white; font-weight: bold; }
        .total-global-value { background-color: #d9534f; text-align: right; color: white; font-weight: bold; }
    </style>
</head>
<body>
<header>
    <a href="index.html" class="home-button">Accueil</a>
    Synthèse par Jour / Mois / Année
</header>
<div class="container">
    <div class="filters">
        <label>Date :
            <input type="date" id="dateInput">
        </label>
        <button onclick="loadSyntheseJour()">Voir Jour</button>
        <label>Mois :
            <input type="month" id="monthInput">
        </label>
        <button onclick="loadSyntheseMois()">Voir Mois</button>
        <label>Année :
            <input type="number" id="yearInput" min="2000" value="2025">
        </label>
        <button onclick="loadSyntheseAnnee()">Voir Année</button>
    </div>
    <table>
        <thead>
        <tr>
            <th>Table</th>
            <th>Total (NET)</th>
        </tr>
        </thead>
        <tbody id="syntheseTable"></tbody>
        <tfoot>
        <tr><td class="cumul-mensuel-label">Cumul Mensuel</td><td class="cumul-mensuel-value" id="cumulMensuelTotal">0.00</td></tr>
        <tr><td class="cumul-annuel-label">Cumul Annuel</td><td class="cumul-annuel-value" id="cumulAnnuelTotal">0.00</td></tr>
        <tr><td class="total-global-label">GLOBAL</td><td class="total-global-value" id="globalTotal">0.00</td></tr>
        </tfoot>
    </table>
</div>
<script>
    const order = [
        'dsClassique', 'dsNord', 'chauxViveLafarge', 'cbulkArgentifere',
        'chauxVive', 'controleBasculeHJDS', 'controleBasculeKA',
        'expCuivreNord', 'expCuivreOncf', 'expPbCmgOnf',
        'expZincOncf', 'expZincSafi'
    ];
    function displaySynthese(data) {
        const tbody = document.getElementById("syntheseTable");
        tbody.innerHTML = '';
        order.forEach(key => {
            const value = (data[key] || 0).toFixed(2);
            const row = `<tr><td>${key}</td><td>${value}</td></tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
        });
        document.getElementById("cumulMensuelTotal").textContent = (data.cumulMensuel || 0).toFixed(2);
        document.getElementById("cumulAnnuelTotal").textContent = (data.cumulAnnuel || 0).toFixed(2);
        document.getElementById("globalTotal").textContent = (data.global || 0).toFixed(2);
    }
    function loadSyntheseJour() {
        const date = document.getElementById("dateInput").value;
        if (!date) return alert("Veuillez choisir une date !");
        fetch(`/api/synthese-jour?jour=${date}`)
            .then(r => r.json()).then(displaySynthese)
            .catch(err => alert("Erreur synthèse jour : " + err));
    }
    function loadSyntheseMois() {
        const mois = document.getElementById("monthInput").value;
        if (!mois) return alert("Veuillez choisir un mois !");
        fetch(`/api/synthese-mois?mois=${mois}`)
            .then(r => r.json()).then(displaySynthese)
            .catch(err => alert("Erreur synthèse mois : " + err));
    }
    function loadSyntheseAnnee() {
        const annee = document.getElementById("yearInput").value;
        if (!annee) return alert("Veuillez choisir une année !");
        fetch(`/api/synthese-annuelle?annee=${annee}`)
            .then(r => r.json()).then(displaySynthese)
            .catch(err => alert("Erreur synthèse annuelle : " + err));
    }
    document.addEventListener("DOMContentLoaded", () => {
        const today = new Date().toISOString().slice(0, 10);
        document.getElementById("dateInput").value = today;
        loadSyntheseJour();
    });
</script>
</body>
</html>
